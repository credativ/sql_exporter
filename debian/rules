#!/usr/bin/make -f

export GOPATH=/usr/share/gocode

%:
	dh $@ --with=systemd

override_dh_auto_build:
	go build

override_dh_auto_test:
	go test

override_dh_auto_install:
	mkdir -p debian/prometheus-sql-exporter/usr/bin
	install sql_exporter debian/prometheus-sql-exporter/usr/bin/prometheus-sql-exporter

override_dh_installman:
	PATH=$(PATH):debian/prometheus-sql-exporter/usr/bin \
	help2man --no-discard-stderr --no-info \
		--name "SQL Exporter for Prometheus" \
		--version-string=$(shell dpkg-parsechangelog -S Version) \
		prometheus-sql-exporter > prometheus-sql-exporter.1
	dh_installman
